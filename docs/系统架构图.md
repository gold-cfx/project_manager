# 科研项目管理系统 - 完整架构图

## 系统总体架构

- 在线查看网址: https://mermaid.live

```mermaid
graph TB
    subgraph "前端界面层"
        UI[PyQt5用户界面]
        subgraph "主窗口组件"
            MW[主窗口 MainWindow]
            LM[登录模块 LoginDialog]
            MB[菜单栏 MenuBar]
            TB[工具栏 ToolBar]
            SB[状态栏 StatusBar]
        end
        
        subgraph "功能模块界面"
            PR[项目登记 ProjectRegistration]
            PQ[项目查询 ProjectQuery]
            RM[提醒管理 ReminderManagement]
            UP[用户面板 UserPanel]
        end
        
        subgraph "对话框组件"
            AD[添加项目对话框]
            ED[编辑项目对话框]
            DL[删除确认对话框]
            EM[Excel导入对话框]
            CD[图表展示对话框]
        end
    end

    subgraph "业务逻辑层"
        subgraph "核心业务模块"
            PM[项目管理逻辑 ProjectManager]
            QM[查询管理逻辑 QueryManager]
            RM_LOGIC[提醒逻辑 ReminderLogic]
            UM[用户管理逻辑 UserManager]
            AUTH[权限认证逻辑 AuthManager]
        end
        
        subgraph "数据处理模块"
            EH[Excel处理器 ExcelHandler]
            CH[图表生成器 ChartHandler]
            DH[数据验证器 DataValidator]
            CALC[计算引擎 Calculator]
        end
        
        subgraph "定时任务"
            AR[自动提醒 AutoReminder]
            TM[定时器管理 TimerManager]
        end
    end

    subgraph "数据访问层"
        subgraph "数据库操作"
            DB[数据库连接管理 DatabaseConnection]
            DAO[数据访问对象 DAO]
            MODEL[数据模型 Models]
        end
        
        subgraph "文件存储"
            FS[文件服务器 FileServer]
            UPLOAD[文件上传器 Uploader]
            DOWNLOAD[文件下载器 Downloader]
        end
    end

    subgraph "基础设施层"
        subgraph "数据库"
            MYSQL[(MySQL数据库)]
            subgraph "数据表"
                T1[projects 项目表]
                T2[project_result 成果表]
                T3[project_result_attachment 附件表]
                T4[users 用户表]
                T5[reminders 提醒表]
            end
        end
        
        subgraph "文件系统"
            LOCAL[本地文件系统]
            EXCEL[Excel模板文件]
            CONFIG[配置文件]
            LOGS[日志文件]
        end
        
        subgraph "第三方服务"
            PYQT5[PyQt5框架]
            PANDAS[Pandas数据处理]
            MATPLOTLIB[Matplotlib图表]
            PYMYSQL[PyMySQL驱动]
        end
    end

    subgraph "跨层服务"
        LOG[日志服务 Logger]
        CONF[配置管理 Config]
        CACHE[缓存机制 Cache]
        SECURITY[安全模块 Security]
    end

    %% 前端到业务逻辑层连接
    UI --> PM
    PR --> PM
    PQ --> QM
    RM --> RM_LOGIC
    
    %% 业务逻辑层内部连接
    PM --> AUTH
    PM --> DH
    QM --> CH
    RM_LOGIC --> AR
    
    %% 业务逻辑到数据访问层
    PM --> DAO
    QM --> DAO
    RM_LOGIC --> DAO
    EH --> DAO
    
    %% 数据访问到基础设施
    DAO --> DB
    DB --> MYSQL
    FS --> LOCAL
    
    %% 跨层服务连接
    PM -.-> LOG
    QM -.-> LOG
    RM_LOGIC -.-> LOG
    AUTH -.-> SECURITY
    
    style UI fill:#e1f5fe
    style PM fill:#fff3e0
    style DB fill:#f3e5f5
    style MYSQL fill:#e8f5e9
    style LOG fill:#fce4ec
```

## 模块详细架构图

### 1. 用户界面架构

```mermaid
graph TD
    subgraph "主窗口 MainWindow"
        MW[MainWindow类]
        subgraph "菜单结构"
            M1[项目管理]
            M2[查询统计]
            M3[提醒管理]
            M4[系统管理]
        end
        
        subgraph "工具栏按钮"
            B1[添加项目]
            B2[查询项目]
            B3[导出Excel]
            B4[生成图表]
        end
        
        subgraph "状态栏信息"
            S1[当前用户]
            S2[项目总数]
            S3[待办提醒]
            S4[系统时间]
        end
    end
    
    MW --> M1
    MW --> M2
    MW --> M3
    MW --> M4
    MW --> B1
    MW --> B2
    MW --> B3
    MW --> B4
    MW --> S1
    MW --> S2
    MW --> S3
    MW --> S4
```

### 2. 项目管理模块架构

```mermaid
graph TD
    subgraph "项目管理模块"
        PM[ProjectManager类]
        
        subgraph "项目登记"
            PR[ProjectRegistration类]
            ADD[添加项目]
            EDIT[编辑项目]
            DELETE[删除项目]
        end
        
        subgraph "Excel处理"
            EH[ExcelHandler类]
            TEMPLATE[生成模板]
            IMPORT[批量导入]
            EXPORT[数据导出]
        end
        
        subgraph "数据验证"
            DV[DataValidator类]
            VALIDATE[字段验证]
            FORMAT[格式检查]
            DUPLICATE[重复检查]
        end
    end
    
    PM --> PR
    PR --> ADD
    PR --> EDIT
    PR --> DELETE
    PM --> EH
    EH --> TEMPLATE
    EH --> IMPORT
    EH --> EXPORT
    ADD --> DV
    IMPORT --> DV
    DV --> VALIDATE
    DV --> FORMAT
    DV --> DUPLICATE
```

### 3. 查询统计模块架构

```mermaid
graph TD
    subgraph "查询统计模块"
        QM[QueryManager类]
        PQ[ProjectQuery类]
        
        subgraph "查询功能"
            BASIC[基础查询]
            ADVANCED[高级查询]
            FILTER[条件筛选]
            SORT[排序功能]
        end
        
        subgraph "图表生成"
            CH[ChartHandler类]
            BAR[柱状图]
            PIE[饼图]
            LINE[折线图]
            EXPORT_CHART[图表导出]
        end
        
        subgraph "数据展示"
            TABLE[表格展示]
            DETAIL[详情查看]
            SUMMARY[统计摘要]
        end
    end
    
    QM --> PQ
    PQ --> BASIC
    PQ --> ADVANCED
    PQ --> FILTER
    PQ --> SORT
    QM --> CH
    CH --> BAR
    CH --> PIE
    CH --> LINE
    CH --> EXPORT_CHART
    PQ --> TABLE
    TABLE --> DETAIL
    TABLE --> SUMMARY
```

### 4. 提醒系统架构

```mermaid
graph TD
    subgraph "提醒系统"
        AR[AutoReminder类]
        RM[ReminderManagement类]
        
        subgraph "定时检查"
            TIMER[定时器]
            CHECK[检查到期项目]
            GENERATE[生成提醒]
        end
        
        subgraph "提醒管理"
            LIST[提醒列表]
            READ[标记已读]
            DELETE[删除提醒]
            SETTINGS[提醒设置]
        end
        
        subgraph "通知机制"
            POPUP[弹窗提醒]
            SOUND[声音提醒]
            TRAY[系统托盘]
        end
    end
    
    AR --> TIMER
    TIMER --> CHECK
    CHECK --> GENERATE
    GENERATE --> POPUP
    
    RM --> LIST
    RM --> READ
    RM --> DELETE
    RM --> SETTINGS
    
    POPUP --> SOUND
    POPUP --> TRAY
```

### 5. 数据流架构图

```mermaid
graph LR
    subgraph "用户操作"
        USER[用户]
    end
    
    subgraph "界面层"
        UI[PyQt5界面]
    end
    
    subgraph "业务逻辑"
        BL[业务逻辑层]
        VALID[数据验证]
        CALC[计算处理]
    end
    
    subgraph "数据访问"
        DAO[DAO层]
        CACHE[缓存]
    end
    
    subgraph "数据存储"
        DB[(MySQL)]
        FILE[文件系统]
    end
    
    USER --> UI
    UI --> BL
    BL --> VALID
    VALID --> CALC
    CALC --> DAO
    DAO --> CACHE
    CACHE --> DB
    DAO --> FILE
    
    style USER fill:#e3f2fd
    style UI fill:#f3e5f5
    style BL fill:#fff3e0
    style DAO fill:#e8f5e9
    style DB fill:#ffebee
```

### 6. 技术栈架构

```mermaid
graph TD
    subgraph "表示层"
        PYQT5[PyQt5 5.15.9]
        QSS[QSS样式表]
    end
    
    subgraph "业务逻辑层"
        PYTHON[Python 3.8+]
        PANDAS[Pandas 2.3.1]
        NUMPY[NumPy]
    end
    
    subgraph "数据访问层"
        PYMYSQL[PyMySQL 1.1.1]
        SQLALCHEMY[原生SQL]
    end
    
    subgraph "图表引擎"
        MATPLOTLIB[Matplotlib 3.10.5]
        SEABORN[Seaborn]
    end
    
    subgraph "文件处理"
        OPENPYXL[OpenPyXL]
        XLWT[xlwt]
        XLRD[xlrd]
    end
    
    subgraph "基础设施"
        MYSQL_DB[(MySQL 8.0)]
        FILE_SYS[本地文件系统]
        LOG[日志系统]
    end
    
    PYQT5 --> PYTHON
    PYTHON --> PANDAS
    PANDAS --> MATPLOTLIB
    PYTHON --> PYMYSQL
    PYMYSQL --> MYSQL_DB
    PANDAS --> OPENPYXL
    OPENPYXL --> FILE_SYS
    LOG --> FILE_SYS
```

## 部署架构图

### 单机部署架构

```mermaid
graph TB
    subgraph "用户终端"
        APP[科研项目管理系统.exe]
    end
    
    subgraph "本地环境"
        subgraph "应用程序"
            MAIN[main.exe]
            DLL[依赖DLL]
            CONFIG[config.json]
        end
        
        subgraph "数据存储"
            MYSQL_SVC[MySQL服务]
            DB_FILE[数据库文件]
            ATTACH[附件文件夹]
            LOGS[日志文件夹]
        end
        
        subgraph "运行时"
            PYTHON_RT[Python运行时]
            QT_RT[Qt运行时]
        end
    end
    
    APP --> MAIN
    MAIN --> PYTHON_RT
    MAIN --> QT_RT
    MAIN --> DLL
    MAIN --> CONFIG
    MAIN --> MYSQL_SVC
    MYSQL_SVC --> DB_FILE
    MAIN --> ATTACH
    MAIN --> LOGS
```

## 模块间调用关系图

### 核心调用链

```mermaid
sequenceDiagram
    participant User as 用户
    participant UI as 界面层
    participant Logic as 业务逻辑
    participant DAO as 数据访问
    participant DB as 数据库
    
    Note over User,DB: 项目登记流程
    User->>UI: 点击"添加项目"
    UI->>Logic: 打开项目登记窗口
    User->>UI: 填写项目信息
    User->>UI: 点击"保存"
    UI->>Logic: 验证数据
    Logic->>DAO: 保存项目
    DAO->>DB: 执行SQL插入
    DB-->>DAO: 返回结果
    DAO-->>Logic: 返回成功
    Logic-->>UI: 显示成功消息
    
    Note over User,DB: 项目查询流程
    User->>UI: 点击"查询项目"
    UI->>Logic: 打开查询窗口
    User->>UI: 设置查询条件
    User->>UI: 点击"查询"
    UI->>Logic: 构建查询条件
    Logic->>DAO: 执行查询
    DAO->>DB: 执行SQL查询
    DB-->>DAO: 返回结果集
    DAO-->>Logic: 返回项目列表
    Logic-->>UI: 显示查询结果
    
    Note over User,DB: 自动提醒流程
    Logic->>DAO: 定时检查到期项目
    DAO->>DB: 查询即将到期项目
    DB-->>DAO: 返回到期项目列表
    DAO-->>Logic: 返回提醒数据
    Logic->>UI: 显示提醒弹窗
    UI->>User: 用户收到提醒
```

## 配置文件架构

### 系统配置结构

```yaml
科研项目管理系统/
├── config/
│   ├── settings.py          # 系统配置
│   ├── config.json          # 数据库配置
│   └── qss/                 # 样式文件
├── data/
│   ├── db_connection.py     # 数据库连接
│   ├── models/              # 数据模型
│   └── dao/                 # 数据访问对象
├── ui/
│   ├── main_window.py       # 主窗口
│   ├── project_registration.py
│   ├── project_query.py
│   └── reminder_management.py
├── logic/
│   ├── auto_reminder.py     # 自动提醒
│   └── validators/          # 数据验证器
├── utils/
│   ├── logger.py            # 日志系统
│   ├── decorators.py        # 装饰器
│   └── helpers.py           # 工具函数
├── file_server/             # 文件服务器
├── logs/                    # 日志文件
└── docs/                    # 文档目录
```

## 性能架构设计

### 缓存机制

```mermaid
graph TD
    subgraph "缓存层次"
        L1[界面缓存]
        L2[业务逻辑缓存]
        L3[数据访问缓存]
    end
    
    subgraph "缓存内容"
        L1 --> USER_DATA[用户数据]
        L1 --> UI_STATE[界面状态]
        
        L2 --> QUERY_CACHE[查询结果]
        L2 --> CALC_CACHE[计算结果]
        
        L3 --> DB_CACHE[数据库缓存]
        L3 --> FILE_CACHE[文件缓存]
    end
    
    subgraph "缓存策略"
        STRATEGY1[LRU策略]
        STRATEGY2[定时失效]
        STRATEGY3[手动刷新]
    end
```

这个完整的架构图展示了科研项目管理系统从用户界面到数据存储的全栈架构，包含了前端界面、业务逻辑、数据访问、基础设施等各个层次的详细设计。系统采用分层架构模式，各层之间职责清晰，便于维护和扩展。