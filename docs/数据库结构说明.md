# ç§‘ç ”é¡¹ç›®ç®¡ç†ç³»ç»Ÿ - æ•°æ®åº“ç»“æ„è¯¦ç»†è¯´æ˜

## ğŸ“Š æ•°æ®åº“æ¦‚è§ˆ

### åŸºæœ¬ä¿¡æ¯
- **æ•°æ®åº“åç§°**: `research_project_db`
- **å­—ç¬¦é›†**: `utf8mb4` (æ”¯æŒå®Œæ•´Unicodeå­—ç¬¦)
- **å­˜å‚¨å¼•æ“**: `InnoDB` (æ”¯æŒäº‹åŠ¡å’Œå¤–é”®)
- **è¡¨æ•°é‡**: 7ä¸ªæ ¸å¿ƒè¡¨
- **å¤–é”®å…³ç³»**: 6ä¸ªä¸»è¦å…³è”

### è¡¨ç»“æ„æ¸…å•

| è¡¨å | åŠŸèƒ½æè¿° | ä¸»é”® | å¤–é”® | è®°å½•æ•° |
|------|----------|------|------|--------|
| `users` | ç”¨æˆ·ä¿¡æ¯ç®¡ç† | `id` | - | ç³»ç»Ÿç”¨æˆ· |
| `projects` | é¡¹ç›®åŸºæœ¬ä¿¡æ¯ | `id` | - | é¡¹ç›®è®°å½• |
| `project_result` | é¡¹ç›®æˆæœä¿¡æ¯ | `id` | `project_id` | æˆæœè®°å½• |
| `project_result_attachment` | æˆæœé™„ä»¶æ–‡ä»¶ | `id` | `project_result_id` | é™„ä»¶è®°å½• |
| `reminders` | é¡¹ç›®æé†’ç³»ç»Ÿ | `id` | `project_id` | æé†’è®°å½• |
| `data_dicts` | æ•°æ®å­—å…¸é…ç½® | `id` | - | å­—å…¸é¡¹ |
| `help_docs` | å¸®åŠ©æ–‡æ¡£ç®¡ç† | `id` | - | æ–‡æ¡£è®°å½• |
| `system_config` | ç³»ç»Ÿé…ç½®å‚æ•° | `id` | - | é…ç½®é¡¹ |

## ğŸ”— è¡¨å…³ç³»å›¾

### å®ä½“å…³ç³»å›¾ (ERD)

```mermaid
erDiagram
    users ||--o{ projects : "åˆ›å»º/ç®¡ç†"
    users ||--o{ reminders : "æ¥æ”¶æé†’"
    
    projects ||--o{ project_result : "åŒ…å«æˆæœ"
    projects ||--o{ reminders : "è§¦å‘æé†’"
    
    project_result ||--o{ project_result_attachment : "å…³è”é™„ä»¶"
    
    data_dicts ||--o{ projects : "æä¾›é€‰é¡¹å€¼"
```

### å…³ç³»è¯´æ˜

1. **ç”¨æˆ·-é¡¹ç›®å…³ç³»** (1:N)
   - ä¸€ä¸ªç”¨æˆ·å¯ä»¥ç®¡ç†å¤šä¸ªé¡¹ç›®
   - é€šè¿‡ç”¨æˆ·IDéšå¼å…³è”

2. **é¡¹ç›®-æˆæœå…³ç³»** (1:N)
   - ä¸€ä¸ªé¡¹ç›®å¯ä»¥æœ‰å¤šä¸ªæˆæœ
   - å¤–é”®çº¦æŸç¡®ä¿æ•°æ®å®Œæ•´æ€§

3. **æˆæœ-é™„ä»¶å…³ç³»** (1:N)
   - ä¸€ä¸ªæˆæœå¯ä»¥æœ‰å¤šä¸ªé™„ä»¶æ–‡ä»¶
   - æ”¯æŒæ–‡ä»¶æœåŠ¡å™¨é›†æˆ

4. **é¡¹ç›®-æé†’å…³ç³»** (1:N)
   - ä¸€ä¸ªé¡¹ç›®å¯ä»¥æœ‰å¤šä¸ªæé†’è®¾ç½®
   - æ”¯æŒå¤šç§æé†’ç±»å‹å’Œæ–¹å¼

## ğŸ—ï¸ è¯¦ç»†è¡¨ç»“æ„

### 1. ç”¨æˆ·è¡¨ (`users`)

#### å­—æ®µç»“æ„
```sql
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL COMMENT 'ç”¨æˆ·å',
    password VARCHAR(64) NOT NULL COMMENT 'å¯†ç ï¼ˆåŠ å¯†å­˜å‚¨ï¼‰',
    real_name VARCHAR(50) NOT NULL COMMENT 'çœŸå®å§“å',
    role VARCHAR(20) DEFAULT 'user' COMMENT 'è§’è‰²ï¼šadmin/user',
    status VARCHAR(20) DEFAULT 'active' COMMENT 'çŠ¶æ€ï¼šactive/inactive',
    email VARCHAR(100) COMMENT 'é‚®ç®±åœ°å€',
    phone VARCHAR(20) COMMENT 'è”ç³»ç”µè¯',
    last_login TIMESTAMP COMMENT 'æœ€åç™»å½•æ—¶é—´',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
);
```

#### ç´¢å¼•è®¾è®¡
- **ä¸»é”®ç´¢å¼•**: `PRIMARY KEY (id)`
- **å”¯ä¸€ç´¢å¼•**: `UNIQUE KEY uk_username (username)`
- **æ™®é€šç´¢å¼•**: `KEY idx_status (status)`
- **æ—¶é—´ç´¢å¼•**: `KEY idx_create_time (create_time)`

### 2. é¡¹ç›®è¡¨ (`projects`)

#### å­—æ®µç»“æ„
```sql
CREATE TABLE projects (
    id INT AUTO_INCREMENT PRIMARY KEY,
    project_name VARCHAR(255) UNIQUE NOT NULL COMMENT 'é¡¹ç›®åç§°',
    leader VARCHAR(50) NOT NULL COMMENT 'é¡¹ç›®è´Ÿè´£äºº',
    department VARCHAR(50) NOT NULL COMMENT 'æ‰€å±éƒ¨é—¨',
    phone VARCHAR(20) NOT NULL COMMENT 'è”ç³»ç”µè¯',
    project_source VARCHAR(50) NOT NULL COMMENT 'é¡¹ç›®æ¥æº',
    project_type VARCHAR(50) NOT NULL COMMENT 'é¡¹ç›®ç±»å‹',
    level VARCHAR(20) NOT NULL COMMENT 'é¡¹ç›®çº§åˆ«',
    funding_amount DECIMAL(15,2) NOT NULL COMMENT 'èµ„åŠ©é‡‘é¢',
    funding_unit VARCHAR(100) NOT NULL COMMENT 'èµ„åŠ©å•ä½',
    approval_year VARCHAR(20) NOT NULL COMMENT 'æ‰¹å‡†å¹´ä»½',
    project_number VARCHAR(50) NOT NULL COMMENT 'é¡¹ç›®ç¼–å·',
    start_date DATE NOT NULL COMMENT 'å¼€å§‹æ—¥æœŸ',
    end_date DATE NOT NULL COMMENT 'ç»“æŸæ—¥æœŸ',
    status VARCHAR(20) DEFAULT 'è¿›è¡Œä¸­' COMMENT 'é¡¹ç›®çŠ¶æ€',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
);
```

#### ç´¢å¼•è®¾è®¡
- **ä¸»é”®ç´¢å¼•**: `PRIMARY KEY (id)`
- **å”¯ä¸€ç´¢å¼•**: `UNIQUE KEY uk_project_name (project_name)`
- **å¤åˆç´¢å¼•**: `KEY idx_leader_status (leader, status)`
- **æ—¶é—´ç´¢å¼•**: `KEY idx_end_date (end_date)`
- **æ¥æºç´¢å¼•**: `KEY idx_project_source (project_source)`

### 3. é¡¹ç›®æˆæœè¡¨ (`project_result`)

#### å­—æ®µç»“æ„
```sql
CREATE TABLE project_result (
    id INT AUTO_INCREMENT PRIMARY KEY,
    project_id INT NOT NULL COMMENT 'å…³è”é¡¹ç›®ID',
    type VARCHAR(20) NOT NULL COMMENT 'æˆæœç±»å‹',
    name VARCHAR(255) NOT NULL COMMENT 'æˆæœåç§°',
    date DATE NOT NULL COMMENT 'æˆæœæ—¥æœŸ',
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);
```

#### ç´¢å¼•è®¾è®¡
- **ä¸»é”®ç´¢å¼•**: `PRIMARY KEY (id)`
- **å¤–é”®ç´¢å¼•**: `KEY idx_project_id (project_id)`
- **ç±»å‹ç´¢å¼•**: `KEY idx_type (type)`
- **æ—¶é—´ç´¢å¼•**: `KEY idx_date (date)`

### 4. æˆæœé™„ä»¶è¡¨ (`project_result_attachment`)

#### å­—æ®µç»“æ„
```sql
CREATE TABLE project_result_attachment (
    id INT AUTO_INCREMENT PRIMARY KEY,
    project_result_id INT NOT NULL COMMENT 'å…³è”æˆæœID',
    file_name VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶å',
    file_path VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶è·¯å¾„',
    file_server_host VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶æœåŠ¡å™¨ä¸»æœº',
    file_server_port VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶æœåŠ¡å™¨ç«¯å£',
    file_storage_directory VARCHAR(255) NOT NULL COMMENT 'å­˜å‚¨ç›®å½•',
    upload_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'ä¸Šä¼ æ—¶é—´',
    FOREIGN KEY (project_result_id) REFERENCES project_result(id) ON DELETE CASCADE
);
```

#### ç´¢å¼•è®¾è®¡
- **ä¸»é”®ç´¢å¼•**: `PRIMARY KEY (id)`
- **å¤–é”®ç´¢å¼•**: `KEY idx_project_result_id (project_result_id)`
- **æ–‡ä»¶ç´¢å¼•**: `KEY idx_file_name (file_name)`

### 5. æé†’è¡¨ (`reminders`)

#### å­—æ®µç»“æ„
```sql
CREATE TABLE reminders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    project_id INT NOT NULL COMMENT 'å…³è”é¡¹ç›®ID',
    project_name VARCHAR(255) NOT NULL COMMENT 'é¡¹ç›®åç§°',
    reminder_type VARCHAR(20) NOT NULL COMMENT 'æé†’ç±»å‹',
    days_before INT NOT NULL COMMENT 'æå‰å¤©æ•°',
    reminder_way VARCHAR(20) NOT NULL COMMENT 'æé†’æ–¹å¼',
    content TEXT COMMENT 'æé†’å†…å®¹',
    start_date DATE NOT NULL COMMENT 'å¼€å§‹æ—¥æœŸ',
    status VARCHAR(10) DEFAULT 'æœªè¯»' COMMENT 'æé†’çŠ¶æ€',
    create_time TIMESTAMP NOT NULL COMMENT 'åˆ›å»ºæ—¶é—´',
    FOREIGN KEY (project_id) REFERENCES projects(id) ON DELETE CASCADE
);
```

#### ç´¢å¼•è®¾è®¡
- **ä¸»é”®ç´¢å¼•**: `PRIMARY KEY (id)`
- **å¤–é”®ç´¢å¼•**: `KEY idx_project_id (project_id)`
- **çŠ¶æ€ç´¢å¼•**: `KEY idx_status (status)`
- **æ—¶é—´ç´¢å¼•**: `KEY idx_start_date (start_date)`

### 6. æ•°æ®å­—å…¸è¡¨ (`data_dicts`)

#### å­—æ®µç»“æ„
```sql
CREATE TABLE data_dicts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    dict_type VARCHAR(50) NOT NULL COMMENT 'å­—å…¸ç±»å‹',
    dict_key VARCHAR(50) NOT NULL COMMENT 'å­—å…¸é”®',
    dict_value VARCHAR(100) NOT NULL COMMENT 'å­—å…¸å€¼',
    sort_order INT DEFAULT 0 COMMENT 'æ’åº',
    is_active TINYINT(1) DEFAULT 1 COMMENT 'æ˜¯å¦æ¿€æ´»',
    description VARCHAR(200) COMMENT 'æè¿°',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
);
```

#### ç´¢å¼•è®¾è®¡
- **ä¸»é”®ç´¢å¼•**: `PRIMARY KEY (id)`
- **å¤åˆå”¯ä¸€ç´¢å¼•**: `UNIQUE KEY uk_dict_type_key (dict_type, dict_key)`
- **ç±»å‹ç´¢å¼•**: `KEY idx_dict_type (dict_type)`
- **çŠ¶æ€ç´¢å¼•**: `KEY idx_is_active (is_active)`

### 7. å¸®åŠ©æ–‡æ¡£è¡¨ (`help_docs`)

#### å­—æ®µç»“æ„
```sql
CREATE TABLE help_docs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL COMMENT 'æ–‡æ¡£æ ‡é¢˜',
    content TEXT COMMENT 'æ–‡æ¡£å†…å®¹',
    version VARCHAR(20) COMMENT 'æ–‡æ¡£ç‰ˆæœ¬',
    create_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
);
```

### 8. ç³»ç»Ÿé…ç½®è¡¨ (`system_config`)

#### å­—æ®µç»“æ„
```sql
CREATE TABLE system_config (
    id INT AUTO_INCREMENT PRIMARY KEY,
    config_key VARCHAR(100) UNIQUE NOT NULL COMMENT 'é…ç½®é”®',
    config_value TEXT COMMENT 'é…ç½®å€¼',
    description VARCHAR(200) COMMENT 'æè¿°',
    update_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´'
);
```

## ğŸ¯ æ•°æ®å­—å…¸é…ç½®ç¤ºä¾‹

### é¡¹ç›®æ¥æºé…ç½®
```sql
INSERT INTO data_dicts (dict_type, dict_key, dict_value, sort_order) VALUES
('project_source', 'national', 'å›½å®¶çº§', 1),
('project_source', 'provincial', 'çœéƒ¨çº§', 2),
('project_source', 'school', 'æ ¡çº§', 3),
('project_source', 'enterprise', 'ä¼ä¸šåˆä½œ', 4);
```

### é¡¹ç›®ç±»å‹é…ç½®
```sql
INSERT INTO data_dicts (dict_type, dict_key, dict_value, sort_order) VALUES
('project_type', 'basic', 'åŸºç¡€ç ”ç©¶', 1),
('project_type', 'applied', 'åº”ç”¨ç ”ç©¶', 2),
('project_type', 'development', 'å¼€å‘ç ”ç©¶', 3),
('project_type', 'policy', 'æ”¿ç­–ç ”ç©¶', 4);
```

### é¡¹ç›®çº§åˆ«é…ç½®
```sql
INSERT INTO data_dicts (dict_type, dict_key, dict_value, sort_order) VALUES
('level', 'major', 'é‡å¤§é¡¹ç›®', 1),
('level', 'key', 'é‡ç‚¹é¡¹ç›®', 2),
('level', 'general', 'ä¸€èˆ¬é¡¹ç›®', 3),
('level', 'youth', 'é’å¹´é¡¹ç›®', 4);
```

## ğŸ” æŸ¥è¯¢ä¼˜åŒ–å»ºè®®

### å¸¸ç”¨æŸ¥è¯¢ç´¢å¼•
1. **é¡¹ç›®æŸ¥è¯¢ä¼˜åŒ–**
   ```sql
   -- æŒ‰è´Ÿè´£äººå’ŒçŠ¶æ€æŸ¥è¯¢
   CREATE INDEX idx_leader_status ON projects(leader, status);
   
   -- æŒ‰ç»“æŸæ—¥æœŸèŒƒå›´æŸ¥è¯¢
   CREATE INDEX idx_end_date ON projects(end_date);
   
   -- æŒ‰æ¥æºå’Œç±»å‹æŸ¥è¯¢
   CREATE INDEX idx_source_type ON projects(project_source, project_type);
   ```

2. **æé†’ç³»ç»Ÿä¼˜åŒ–**
   ```sql
   -- æŒ‰çŠ¶æ€å’Œæ—¥æœŸæŸ¥è¯¢æé†’
   CREATE INDEX idx_status_date ON reminders(status, start_date);
   
   -- æŒ‰é¡¹ç›®IDå’ŒçŠ¶æ€æŸ¥è¯¢
   CREATE INDEX idx_project_status ON reminders(project_id, status);
   ```

3. **æ•°æ®å­—å…¸ä¼˜åŒ–**
   ```sql
   -- æŒ‰ç±»å‹å’Œæ¿€æ´»çŠ¶æ€æŸ¥è¯¢
   CREATE INDEX idx_type_active ON data_dicts(dict_type, is_active);
   ```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### è¡¨å¤§å°ç›‘æ§
```sql
-- æŸ¥çœ‹å„è¡¨è®°å½•æ•°
SELECT 
    table_name,
    table_rows,
    ROUND(data_length/1024/1024, 2) AS data_size_mb,
    ROUND(index_length/1024/1024, 2) AS index_size_mb
FROM information_schema.tables 
WHERE table_schema = 'research_project_db'
ORDER BY data_length DESC;
```

### ç´¢å¼•ä½¿ç”¨æƒ…å†µ
```sql
-- æŸ¥çœ‹ç´¢å¼•ä½¿ç”¨ç»Ÿè®¡
SHOW INDEX FROM projects;
SHOW INDEX FROM reminders;
```

## ğŸ›¡ï¸ æ•°æ®å®Œæ•´æ€§çº¦æŸ

### å¤–é”®çº¦æŸ
- **projects â†’ project_result**: çº§è”åˆ é™¤
- **projects â†’ reminders**: çº§è”åˆ é™¤
- **project_result â†’ project_result_attachment**: çº§è”åˆ é™¤

### å”¯ä¸€çº¦æŸ
- `users.username`: ç”¨æˆ·åå”¯ä¸€
- `projects.project_name`: é¡¹ç›®åç§°å”¯ä¸€
- `system_config.config_key`: é…ç½®é”®å”¯ä¸€
- `data_dicts(dict_type, dict_key)`: å­—å…¸é”®å”¯ä¸€

### æ£€æŸ¥çº¦æŸ
- `projects.end_date > projects.start_date`: ç»“æŸæ—¥æœŸå¿…é¡»æ™šäºå¼€å§‹æ—¥æœŸ
- `reminders.days_before >= 0`: æå‰å¤©æ•°å¿…é¡»ä¸ºéè´Ÿæ•°
- `data_dicts.sort_order >= 0`: æ’åºå€¼å¿…é¡»ä¸ºéè´Ÿæ•°

## ğŸ”„ å¤‡ä»½ç­–ç•¥

### è‡ªåŠ¨å¤‡ä»½è„šæœ¬
```bash
#!/bin/bash
# æ¯æ—¥å¤‡ä»½è„šæœ¬
DATE=$(date +%Y%m%d_%H%M%S)
mysqldump -u username -p research_project_db > backup_${DATE}.sql
gzip backup_${DATE}.sql
find . -name "backup_*.sql.gz" -mtime +7 -delete
```

### æ•°æ®æ¢å¤
```sql
-- æ¢å¤å¤‡ä»½
mysql -u username -p research_project_db < backup_20241201_120000.sql
```

## ğŸ“‹ ç‰ˆæœ¬æ§åˆ¶

### æ•°æ®åº“ç‰ˆæœ¬è®°å½•
```sql
CREATE TABLE db_version (
    version VARCHAR(20) PRIMARY KEY,
    description TEXT,
    update_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

INSERT INTO db_version (version, description) VALUES
('1.0.0', 'åˆå§‹ç‰ˆæœ¬ï¼ŒåŒ…å«åŸºæœ¬è¡¨ç»“æ„'),
('1.1.0', 'æ·»åŠ æé†’ç³»ç»Ÿè¡¨'),
('1.2.0', 'ä¼˜åŒ–ç´¢å¼•å’ŒæŸ¥è¯¢æ€§èƒ½');
```

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0.0  
**åˆ›å»ºæ—¥æœŸ**: 2024-12-01  
**æ›´æ–°æ—¥æœŸ**: 2024-12-01  
**ç»´æŠ¤äººå‘˜**: ç³»ç»Ÿç®¡ç†å‘˜